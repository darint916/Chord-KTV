## üìù Directory Explanation
![Build Status](https://github.com/darint916/Chord-KTV/actions/workflows/dotnet-build-run-check.yml/badge.svg) ![Style Police Status](https://github.com/darint916/Chord-KTV/actions/workflows/enforce-code-style.yml/badge.svg)![Build Status](https://github.com/darint916/Chord-KTV/actions/workflows/react-build-check.yml/badge.svg) ![Style Police Status](https://github.com/darint916/Chord-KTV/actions/workflows/frontend-code-style.yml/badge.svg)


- **Controllers/** - Contains API controllers that handle incoming HTTP requests.
- **Data/** - Holds Repository facing files to directly query database, migrate database, and context.
- **Dtos/** - Houses Data Transfer Objects (DTOs) to structure API responses and also any other business logic models
- **Migrations/** - Stores database migration scripts for schema updates.
- **Models/** - Defines the application's core data models. (From Db)
- **Profiles/** - AutoMapper profiles for object transformations.
- **Properties/** - Holds project-level configuration settings.
- **Services/** - Contains business logic, API integrations (Interfaces), and service classes.
- **Utils/** - Any helper utilities or common functions used across the project.
- **bin/** & **obj/** - Generated by .NET for building and compiling the project.

---

## üí° Contribution Guidelines

1. Follow the existing folder structure when adding new files.
2. Keep controllers focused on request handling, moving logic to services.
3. Use DTOs for API responses to separate models from exposed data.
4. Always test your changes before making a pull request.

## PostgreSQL setup:

Make sure you have the PostgreSQL Docker image pulled, and that Docker Desktop is running.

Before building, run this command:
```bash
docker run -d -e POSTGRES_USER=<uname-for-postgres> -e POSTGRES_PASSWORD=<pwd-for-postgres> -p <free-port-number>:5432 postgres:15.4
```
This will start up a local containerized instance of PostgreSQL.

Create a secrets.json file with these contents:
```
{
    "ConnectionStrings:PostgreSql": "Host=localhost;Port=<port-no-for-postgres>;Database=postgres;Username=<uname-for-postgres>;Password=<pwd-for-postgres>"
}
```

After building, if you see an error like this:
```
fail: Microsoft.EntityFrameworkCore.Database.Command[20102]
      Failed executing DbCommand (17ms) [Parameters=[], CommandType='Text', CommandTimeout='5']
      SELECT "MigrationId", "ProductVersion"
      FROM "__EFMigrationsHistory"
      ORDER BY "MigrationId";
```
It's likely due to an issue with .NET EF core, this can be resolved by running
```bash
dotnet tool install --global dotnet-ef
```

This should allow you to build the project successfully using ```dotnet run```.


## Database model changes
If changes are made to any of the models, a migration is needed. Use PascalCase
```Powershell
dotnet ef migrations add <migration name>
dotnet ef database update
```

## API Documentation

#### ```GET /api/lyrics/lrc/search```

Returns time-synced lyrics from LRCLIB. Attempts to retrieve both original and romanized lyrics if they exist.
We use both of LRCLIB's endpoints (https://lrclib.net/docs), performing an exact match (if at least title and artist exists), and then also a fuzzier search function. Exact searches from most strict parameters to least strict. For the batch search, it sends api requests in parallel from most strict to least (20 entries max each call), along with key word extraction. Post processing involves sorting by fuzzy matching the title and artist and duration. 
When finding romanized lyrics, it does a more strict artist filter search, to match full words with the artist to try to get a very accurate match on the artist names.

## Google Cloud for Handwriting Recognition

Make sure that you have gcloud CLI installed. Run ```gcloud auth application-default login``` before running the backend.
This is a necessary step, since there is no way to pass API key into function call for Google Cloud Vision API.

## License üìúüìù‚öñÔ∏è
This project is licensed under the [**MIT License**](LICENSE). üéºüéµüéß

If you have any questions, feel free to ask in the **issues** section! üöÄüé∂
